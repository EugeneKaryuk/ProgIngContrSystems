# System Emulation

Цей розділ посібника є загальним посібником для користувачів, які використовують QEMU для повної емуляції системи (на відміну від емуляції в режимі користувача). Це включає роботу з такими гіпервізорами, як KVM, Xen, Hax або Hypervisor.Framework.

Завантажте та розпакуйте образ жорсткого диска ПК із встановленим Linux (наприклад, `linux.img`) і введіть:

```
qemu-system-x86_64 linux.img
```

Linux має завантажитися та дати вам підказку. Користувачі повинні знати, що наведений вище приклад усуває велику частину складності налаштування віртуальної машини зі специфічними параметрами x86_64 за замовчуванням і передбачає, що першим неперемикаючим аргументом є образ диска, сумісний з ПК із завантажувальним сектором. Для системи, відмінної від x86, де ми емулюємо широкий діапазон типів машин, командні рядки, як правило, більш чіткі у визначенні машини та поведінки завантаження. Ви знайдете більше прикладів командних рядків у розділі [таргети (targets) емулятора системи QEMU](https://www.qemu.org/docs/master/system/targets.html#system-targets-ref) посібника.

Загальний синтаксис виклику наступний:

```
qemu-system-x86_64 [options] [disk_image]
```

disk_image is a raw hard disk image for IDE hard disk 0. Some таргети do not need a disk image.

- `options` -  опції
- `disk_image` — це необроблений образ жорсткого диска для IDE hard disk 0. Деякі таргети не потребують образу диска.

Повний перелік опцій дотсупний [за посиланням](https://www.qemu.org/docs/master/system/invocation.html), туди входять:

- Standard options, приклади:
  - `-machine [type=]name[,prop=value[,...]` - вибирає емульовану машину за назвою та вказує властивості; наприклад `-machine virt,highmem=off` - вибирає машину з іменем `virt`  та виключеною властивість `highmem`
  - `-cpu model` - вибирає модель процесора (`-cpu help` довідки для вибору списку та додаткових функцій); наприклад `-cpu cortex-a15`
  - `-smp [[cpus=]n][,maxcpus=maxcpus][,sockets=sockets][,dies=dies][,clusters=clusters][,cores=cores][,threads=threads]` - вказує імітувати SMP (симетрична мультпроцесорність) з конкретною кількістю CPU та максимаьною кількістю CPU за можливості такого добавлення; наприклад `-smp 2`  - вказує на кількість процесорів рівною 2
  - `-m [size=]megs[,slots=n,maxmem=size]` - встановлює розмір оперативної пам’яті гостьової системи в мегабайтах, а також можливість добавлення додаткової пам'яті за потреби; наприклад `-m 512M` вказує що кількість пам'яті має бути 512 Мегабайт
  - `-device driver[,prop[=value][,...]]` - додає драйвер пристрою, `prop=value` встановлює залежні від драйвера властивості (`-device help` і `-device driver,help` для довідки); наприклад `-device virtio-net-pci,netdev=net0,mac=A8:74:1D:12:34:02` - добавляє віртуальну мережну карту з іменем `net0` та MAC `A8:74:1D:12:34:02` 
- Block device options, приклади:
  - `-drive option[,option[,option[,...]]]` - означує новий диск, це включає створення вузла блокового драйверу (сервер), а також гостьового пристрою, і це здебільшого ярлик для означення відповідних параметрів `-blockdev` і `-device`; наприклад: `-drive file=sim-axcf1152-image-base-sim-axcf2152.ext4.qcow2,if=virtio,format=qcow2` - вказує що образ диску буде у файлі `sim-axcf1152-image-base-sim-axcf2152.ext4.qcow2` , а диск підключено до `virtio` (VirtIO — це платформа для віртуалізації вводу/виводу, спільна для кількох гіпервізорів в т.ч. qemu) з форматом  `qcow2`
  - `-snapshot` - запис у тимчасові файли замість файлів образів дисків; у цьому випадку необроблений образ диска, який ви використовуєте, не записується назад. Однак ви можете примусово виконати запис, натиснувши `C-a` s (див. розділ `Disk Images` у посібнику користувача системної емуляції).
- USB convenience options
- Display options
  - `-nographic` -  повністю вимкнути графічний вивід, щоб QEMU став простою програмою командного рядка; емульований послідовний порт перенаправляється на консолі та мультиплексується з монітором (якщо не перенаправлено в іншому місці явно); тому ви все ще можете використовувати QEMU для налагодження ядра Linux за допомогою послідовної консолі -  використовуйте `C-a h`, щоб допомогти перемикатися між консоллю та монітором.
- i386 target only
- Network options, приклади:
  - `-netdev user,id=id[,option][,option][,...]` - налаштовує бекенд хост-мережі в режимі користувача, для запуску якого не потрібні права адміністратора; наприклад: `-netdev user,id=net0,hostfwd=tcp::5555-:22,hostfwd=tcp::5050-:443,` - призначає символічну `net0` назву для використання в командах монітора, `hostfwd` (`hostfwd=[tcp|udp]:[hostaddr]:hostport-[guestaddr]:guestport`) -  перенаправляє вхідні з’єднання TCP або UDP що йдуть на хост-порт` hostport` на гостьову IP-адресу `guestaddr` та порт `guestport`, при цьому  оскільки `guestaddr` не вказано, його значення дорівнює `x.x.x.15` (за замовчуванням перша адреса надається вбудованим сервером DHCP)
  - `-net user|tap|bridge|socket|l2tpv3|vde[,...][,name=name]` - налаштовує бекенд хост-мережі (з параметрами, що відповідають тому самому параметру `-netdev`) і підключає його до емульованого концентратора 0 (`hub` за замовчуванням). Використовуйте назву, щоб указати назву порту концентратора
- Character device options
- TPM device options
- Boot Image or Kernel specific
  - `-kernel bzImage` - використовує `bzImage` як образ ядра, ядро може бути або ядром Linux, або у форматі мультизавантаження; наприклад: `-kernel zImage-sim-axcf2152.bin`
  - `-append cmdline` - використовує `cmdline` як командний рядок ядра; наприклад `-append root=/dev/vda rw highres=off ip=dhcp console=ttyAMA0,115200` - вказує блоковий пристрій, який використовуватиметься як коренева файлова система `/dev/vda`, 
- Debug/Expert options
  - `-serial dev` - переспрямовує віртуальний послідовний порт на символьний пристрій хоста,  типово `vc` (`Virtual console`) у графічному режимі та `stdio` у неграфічному режимі; цю опцію можна використовувати кілька разів для імітації до 4 послідовних портів; `serial mon:dev_string` - дозволяє мультиплексувати монітор на інший послідовний порт, доступ до монітора здійснюється за допомогою послідовності клавіш `Control-a`, а потім натискання `c`,  `dev_string` має бути будь-яким із послідовних пристроїв; наприклад  `-serial mon:stdio` - мультиплексує виведення на порт `stdio` 
- Generic object creation
- Device URL Syntax